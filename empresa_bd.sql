DROP DATABASE IF EXISTS BD_EMPRESA;
CREATE DATABASE BD_EMPRESA;
USE BD_EMPRESA;

-- Crear las tablas sin las claves foráneas
DROP TABLE IF EXISTS EMPREGADO;
CREATE TABLE IF NOT EXISTS EMPREGADO (
    NSS VARCHAR(15) PRIMARY KEY,
    NOME VARCHAR(25) NOT NULL,
    APELIDO_1 VARCHAR(25) NOT NULL,
    APELIDO_2 VARCHAR(25) NOT NULL,
    RUA VARCHAR(30) NULL,
    NUMERO_RUA INT NULL,
    PISO VARCHAR(4) NULL,
    CP CHAR(5) NULL,
    LOCALIDADE VARCHAR(25) NULL,
    DATA_NACEMENTO DATE NULL,
    SALARIO FLOAT NULL,
    SEXO CHAR(1) NULL,
    NSS_SUPERVISA VARCHAR(15) NULL,
    NUM_DEPARTAMENTO_PREFERENTE INT NULL
);

DROP TABLE IF EXISTS DEPARTAMENTO;
CREATE TABLE IF NOT EXISTS DEPARTAMENTO (
    NUM_DEPARTAMENTO INT PRIMARY KEY,
    NOME_DEPARTAMENTO VARCHAR(25) NOT NULL,
    NSS_DIRIGE VARCHAR(15) NULL,
    DATA_DIRECCION DATE NULL
);

DROP TABLE IF EXISTS PROXECTO;
CREATE TABLE IF NOT EXISTS PROXECTO (
    NUM_PROXECTO INT PRIMARY KEY,
    NOME_PROXECTO VARCHAR(25) NOT NULL,
    LUGAR VARCHAR(25) NOT NULL,
    NUM_DEPARTAMENTO INT NOT NULL
);

DROP TABLE IF EXISTS EMPREGADO_PROXECTO;
CREATE TABLE IF NOT EXISTS EMPREGADO_PROXECTO (
    NSS_EMPREGADO VARCHAR(15),
    NUM_PROXECTO INT,
    HORAS_SEMANAIS INT NULL,
    PRIMARY KEY (NSS_EMPREGADO, NUM_PROXECTO)
);


-- Insertar empleados
INSERT INTO EMPREGADO (NSS, NOME, APELIDO_1, APELIDO_2, RUA, NUMERO_RUA, PISO, CP, LOCALIDADE, DATA_NACEMENTO, SALARIO, SEXO, NSS_SUPERVISA, NUM_DEPARTAMENTO_PREFERENTE)
VALUES
('123456789', 'Juan', 'Pérez', 'Gómez', 'Calle Falsa', 123, '1A', '08001', 'Barcelona', '1985-06-15', 3000.00, 'M', NULL, 1),
('987654321', 'Ana', 'López', 'Martínez', 'Avenida Siempre Viva', 456, NULL, '08002', 'Barcelona', '1990-02-20', 2800.00, 'F', '123456789', 1),
('456789123', 'Luis', 'García', 'Torres', 'Calle Verdadera', 789, '2B', '08003', 'Madrid', '1982-11-11', 3200.00, 'M', NULL, 2),
('321654987', 'María', 'Sánchez', 'Reyes', 'Calle del Sol', 321, '3C', '08004', 'Madrid', '1995-03-30', 2500.00, 'F', '456789123', 2);

-- Insertar departamentos
INSERT INTO DEPARTAMENTO (NUM_DEPARTAMENTO, NOME_DEPARTAMENTO, NSS_DIRIGE, DATA_DIRECCION)
VALUES
(1, 'Recursos Humanos', '123456789', '2020-01-01'),
(2, 'Desarrollo', '456789123', '2021-02-15');

-- Insertar proyectos
INSERT INTO PROXECTO (NUM_PROXECTO, NOME_PROXECTO, LUGAR, NUM_DEPARTAMENTO)
VALUES
(1, 'Proyecto A', 'Barcelona', 1),
(2, 'Proyecto B', 'Madrid', 2),
(3, 'Proyecto C', 'Barcelona', 1);

-- Insertar asignaciones de empleado a proyectos
INSERT INTO EMPREGADO_PROXECTO (NSS_EMPREGADO, NUM_PROXECTO, HORAS_SEMANAIS)
VALUES
('123456789', 1, 40),
('987654321', 1, 20),
('456789123', 2, 35),
('321654987', 3, 30);



-- Añadir las claves foráneas
ALTER TABLE EMPREGADO
    ADD FOREIGN KEY (NSS_SUPERVISA) REFERENCES EMPREGADO(NSS),
    ADD FOREIGN KEY (NUM_DEPARTAMENTO_PREFERENTE) REFERENCES DEPARTAMENTO(NUM_DEPARTAMENTO);

ALTER TABLE DEPARTAMENTO
    ADD FOREIGN KEY (NSS_DIRIGE) REFERENCES EMPREGADO(NSS);

ALTER TABLE PROXECTO
    ADD FOREIGN KEY (NUM_DEPARTAMENTO) REFERENCES DEPARTAMENTO(NUM_DEPARTAMENTO);

ALTER TABLE EMPREGADO_PROXECTO
    ADD FOREIGN KEY (NSS_EMPREGADO) REFERENCES EMPREGADO(NSS),
    ADD FOREIGN KEY (NUM_PROXECTO) REFERENCES PROXECTO(NUM_PROXECTO);


